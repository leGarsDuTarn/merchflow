<%# app/views/fve/job_offers/_form.html.erb %>

<%= simple_form_for([:fve, @job_offer]) do |f| %>

  <div class="row g-3 g-lg-4">

    <%# ===== COLONNE GAUCHE (8) : INFOS & PLANNING ===== %>
    <div class="col-lg-8">

      <%# --- CARTE 1 : INFOS GÉNÉRALES --- %>
      <div class="card shadow-sm border-0 rounded-4 p-4 p-md-5 mb-3 mb-lg-4 position-relative overflow-hidden">
        <div class="position-absolute top-0 start-0 w-1 bg-orange h-100"></div>

        <div class="d-flex align-items-center mb-4">
          <div class="bg-orange-light text-orange rounded-3 p-3 me-3">
            <i class="fa-solid fa-briefcase fs-4"></i>
          </div>
          <div>
            <h5 class="fw-bold text-dark m-0">Informations Mission</h5>
            <p class="text-muted small mb-0">Définissez le cadre du poste.</p>
          </div>
        </div>

        <div class="row g-3 g-md-4">
          <div class="col-12">
            <%= f.label :title, "TITRE DE L'ANNONCE", class: "form-label small fw-bold text-muted ls-1" %>
            <%= f.input_field :title, class: "form-control bg-light border-0 rounded-pill py-3 px-4 fw-bold fs-6", placeholder: "Ex: Anti-rupture - Rayon Liquide" %>
            <% if @job_offer.errors[:title].any? %>
              <div class="text-danger small mt-1 ms-3"><%= @job_offer.errors[:title].first %></div>
            <% end %>
          </div>

          <div class="col-12">
            <%= f.label :description, "DESCRIPTION", class: "form-label small fw-bold text-muted ls-1" %>
            <%= f.input_field :description, as: :text, rows: 6, class: "form-control bg-light border-0 rounded-4 p-4", placeholder: "Détaillez les tâches..." %>
            <% if @job_offer.errors[:description].any? %>
              <div class="text-danger small mt-1 ms-3"><%= @job_offer.errors[:description].first %></div>
            <% end %>
          </div>

          <div class="col-12 col-md-4">
            <%= f.label :mission_type, "TYPE", class: "form-label small fw-bold text-muted ls-1" %>
            <%= f.input_field :mission_type, collection: JobOffer::MISSION_TYPES.map { |m| [m.capitalize, m] }, class: "form-select bg-light border-0 rounded-pill py-3 px-4" %>
          </div>

          <div class="col-12 col-md-4">
            <%= f.label :contract_type, "CONTRAT", class: "form-label small fw-bold text-muted ls-1" %>
            <%= f.input_field :contract_type, collection: JobOffer::CONTRACT_TYPES.map { |c| [c.upcase, c] }, class: "form-select bg-light border-0 rounded-pill py-3 px-4" %>
          </div>

          <div class="col-12 col-md-4">
            <%= f.label :headcount_required, "EFFECTIF", class: "form-label small fw-bold text-muted ls-1" %>
            <div class="input-group bg-light rounded-pill overflow-hidden">
               <span class="input-group-text bg-transparent border-0 ps-3 text-muted"><i class="fa-solid fa-users"></i></span>
               <%= f.input_field :headcount_required, class: "form-control bg-transparent border-0 py-3 text-center fw-bold", min: 1 %>
            </div>
          </div>
        </div>
      </div>

      <%# --- CARTE 2 : PLANNING FLEXIBLE --- %>
      <div class="card shadow-sm border-0 rounded-4 p-4 p-md-5 mb-3 mb-lg-4" data-controller="nested-form">
        <div class="d-flex align-items-center mb-3">
          <div class="bg-orange-light text-orange rounded-3 p-3 me-3">
            <i class="fa-regular fa-calendar-days fs-4"></i>
          </div>
          <div>
            <h5 class="fw-bold text-dark m-0">Planning Flexible</h5>
            <p class="text-muted small mb-0">Ajoutez les jours et horaires spécifiques.</p>
          </div>
        </div>

        <%# En-têtes des colonnes (CACHÉS SUR MOBILE d-none d-md-flex) %>
        <div class="row g-2 px-2 mb-2 small fw-bold text-muted text-uppercase ls-1 d-none d-md-flex align-items-center">
          <div class="col-md-3"><i class="fa-regular fa-calendar me-1"></i> Date</div>
          <div class="col-md-2 text-center">Début</div>
          <div class="col-md-2 text-center">Fin</div>
          <div class="col-md-2 text-center"><i class="fa-solid fa-mug-hot me-1 opacity-50"></i> Début</div>
          <div class="col-md-2 text-center"><i class="fa-solid fa-mug-hot me-1 opacity-50"></i> Fin</div>
          <div class="col-md-1"></div>
        </div>

        <%# Liste des slots %>
        <div data-nested-form-target="target">
          <%= f.simple_fields_for :job_offer_slots do |slot_form| %>
            <%= render "job_offer_slot_fields", f: slot_form %>
          <% end %>
        </div>

        <%# Bouton Ajout %>
        <div class="mt-3 text-center text-md-start">
          <button type="button" class="btn btn-orange-light text-orange fw-bold rounded-pill px-4 py-2" data-action="nested-form#add">
            <i class="fa-solid fa-plus me-1"></i> Ajouter une date
          </button>
        </div>

        <%# Template caché %>
        <template data-nested-form-target="template">
          <%= f.simple_fields_for :job_offer_slots, JobOfferSlot.new, child_index: 'NEW_RECORD' do |slot_form| %>
            <%= render "job_offer_slot_fields", f: slot_form %>
          <% end %>
        </template>
      </div>

      <%# --- CARTE 3 : LOCALISATION --- %>
      <div class="card shadow-sm border-0 rounded-4 p-4 p-md-5">
        <div class="d-flex align-items-center mb-4">
          <div class="bg-orange-light text-orange rounded-3 p-3 me-3">
            <i class="fa-solid fa-location-dot fs-4"></i>
          </div>
          <div>
            <h5 class="fw-bold text-dark m-0">Localisation</h5>
            <p class="text-muted small mb-0">Où se déroule la mission ?</p>
          </div>
        </div>
        <div class="row g-3">
          <div class="col-12 col-md-6"><%= f.input_field :company_name, class: "form-control bg-light border-0 rounded-pill py-3 px-4", placeholder: "Client Final" %></div>
          <div class="col-12 col-md-6"><%= f.input_field :store_name, class: "form-control bg-light border-0 rounded-pill py-3 px-4", placeholder: "Enseigne" %></div>
          <div class="col-12"><%= f.input_field :address, class: "form-control bg-light border-0 rounded-pill py-3 px-4", placeholder: "Adresse" %></div>
          <div class="col-6 col-md-4"><%= f.input_field :zipcode, class: "form-control bg-light border-0 rounded-pill py-3 px-4", placeholder: "CP" %></div>
          <div class="col-6 col-md-8"><%= f.input_field :city, class: "form-control bg-light border-0 rounded-pill py-3 px-4", placeholder: "Ville" %></div>
        </div>
      </div>
    </div>

    <%# ===== COLONNE DROITE (4) : FINANCE ===== %>
    <div class="col-lg-4">

      <%# --- CARTE FINANCE --- %>
      <div class="card shadow border-0 rounded-4 mb-4">
        <div class="card-header bg-orange-light border-bottom-0 pt-4 px-4 pb-0 rounded-top-4">
          <h5 class="fw-bold text-dark d-flex align-items-center mb-0">
            <i class="fa-solid fa-coins me-2 text-orange"></i>Finances
          </h5>
        </div>

        <div class="card-body p-4 bg-orange-light bg-opacity-10 rounded-bottom-4">
          <div class="row g-3">

            <%# --- TAUX HORAIRE --- %>
            <div class="col-12">
              <%= f.label :hourly_rate, "TAUX HORAIRE BRUT", class: "form-label small fw-bold text-muted ls-1" %>
              <div class="input-group shadow-sm rounded-pill overflow-hidden bg-white border border-white focus-ring">
                <span class="input-group-text bg-transparent border-0 text-dark fw-bold ps-4">€</span>
                <%= f.input_field :hourly_rate, class: "form-control bg-transparent border-0 py-3 text-end fw-bold fs-4", step: 0.01, min: 12.02 %>
                <span class="input-group-text bg-transparent border-0 text-muted pe-4">/ h</span>
              </div>
            </div>

            <%# --- PRIMES --- %>
            <div class="col-12 mt-2">
              <div class="bg-white bg-opacity-60 rounded-4 p-3 border border-white shadow-sm">
                <div class="d-flex align-items-center justify-content-between mb-2">
                  <label class="small fw-bold text-muted mb-0">Précarité</label>
                  <div class="input-group input-group-sm w-auto shadow-sm rounded-pill overflow-hidden" style="max-width: 100px;">
                    <span class="input-group-text bg-white border-0 text-orange fw-bold ps-2">+</span>
                    <%= f.input_field :ifm_rate, class: "form-control border-0 text-center fw-bold text-orange p-1 bg-white", placeholder: "10" %>
                    <span class="input-group-text bg-white border-0 text-orange fw-bold pe-2">%</span>
                  </div>
                </div>

                <div class="d-flex align-items-center justify-content-between">
                  <label class="small fw-bold text-muted mb-0">Congés Payés</label>
                  <div class="input-group input-group-sm w-auto shadow-sm rounded-pill overflow-hidden" style="max-width: 100px;">
                    <span class="input-group-text bg-white border-0 text-orange fw-bold ps-2">+</span>
                    <%= f.input_field :cp_rate, class: "form-control border-0 text-center fw-bold text-orange p-1 bg-white", placeholder: "10" %>
                    <span class="input-group-text bg-white border-0 text-orange fw-bold pe-2">%</span>
                  </div>
                </div>
              </div>
            </div>

            <hr class="text-muted opacity-25 my-3">

            <%# --- SECTION DÉFRAIEMENTS (STIMULUS) --- %>
            <div class="col-12 p-0" data-controller="km-switch">
              <h6 class="fw-bold text-dark small mb-2 px-2"><i class="fa-solid fa-car me-1 text-orange"></i> Défraiements</h6>

              <div class="col-12 mb-2">
                <%= f.label :km_rate, "TAUX REMBOURSEMENT", class: "form-label small fw-bold text-muted ls-1" %>
                <div class="input-group shadow-sm rounded-pill overflow-hidden bg-white border border-white focus-ring">
                  <%= f.input_field :km_rate, class: "form-control bg-transparent border-0 py-2 text-end fw-bold", step: 0.01, placeholder: "0.29" %>
                  <span class="input-group-text bg-transparent border-0 pe-4 text-muted">€/km</span>
                </div>
              </div>

              <div class="col-12 mt-2">
                 <div class="d-flex align-items-center justify-content-between px-3 py-2 bg-white rounded-pill shadow-sm border border-white">
                   <label class="form-check-label small fw-bold text-muted" for="km_unlimited_switch">Distance Illimitée</label>
                   <div class="form-check form-switch m-0">
                     <%= f.check_box :km_unlimited,
                                     class: "form-check-input custom-orange-switch",
                                     id: "km_unlimited_switch",
                                     style: "width: 3em; height: 1.5em; cursor: pointer;",
                                     data: {
                                       km_switch_target: "checkbox",
                                       action: "change->km-switch#toggle"
                                     } %>
                   </div>
                 </div>
              </div>

              <div class="col-12 mt-2 transition-opacity" data-km-switch-target="container">
                <%= f.label :km_limit, "PLAFOND DISTANCE", class: "form-label small fw-bold text-muted ls-1" %>
                <div class="input-group shadow-sm rounded-pill overflow-hidden bg-white border border-white focus-ring">
                  <%= f.input_field :km_limit,
                                    class: "form-control bg-transparent border-0 py-2 text-end",
                                    step: 1,
                                    placeholder: "Ex: 50",
                                    data: { km_switch_target: "input" } %>
                  <span class="input-group-text bg-transparent border-0 pe-4 text-muted">km</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <%# --- CARTE : PARAMÉTRAGE NUIT & MAJORATIONS --- %>
      <div class="card shadow border-0 rounded-4 mb-4">
        <div class="card-header bg-dark border-bottom-0 pt-4 px-4 pb-0 rounded-top-4">
          <h5 class="fw-bold text-white d-flex align-items-center mb-0">
            <i class="fa-solid fa-moon me-2 text-warning"></i>Paramètres Nuit
          </h5>
          <p class="text-white-50 small mb-3">Définissez la plage horaire et le taux applicable.</p>
        </div>

        <div class="card-body p-4 bg-light rounded-bottom-4">
          <div class="row g-3">

            <%# Heure Début (Integer 0-23) %>
            <div class="col-6">
              <%= f.label :night_start, "DÉBUT (H)", class: "form-label small fw-bold text-muted ls-1" %>
              <div class="input-group shadow-sm rounded-3 overflow-hidden bg-white border border-white">
                <span class="input-group-text bg-transparent border-0 ps-3 text-dark"><i class="fa-regular fa-clock"></i></span>
                <%= f.input_field :night_start, class: "form-control bg-transparent border-0 text-center fw-bold", type: "number", min: 0, max: 23 %>
                <span class="input-group-text bg-transparent border-0 pe-3 small text-muted">h</span>
              </div>
              <% if @job_offer.errors[:night_start].any? %>
                <div class="text-danger small mt-1 ms-1"><%= @job_offer.errors[:night_start].first %></div>
              <% end %>
            </div>

            <%# Heure Fin (Integer 0-23) %>
            <div class="col-6">
              <%= f.label :night_end, "FIN (H)", class: "form-label small fw-bold text-muted ls-1" %>
              <div class="input-group shadow-sm rounded-3 overflow-hidden bg-white border border-white">
                <span class="input-group-text bg-transparent border-0 ps-3 text-dark"><i class="fa-solid fa-sun small"></i></span>
                <%= f.input_field :night_end, class: "form-control bg-transparent border-0 text-center fw-bold", type: "number", min: 0, max: 23 %>
                <span class="input-group-text bg-transparent border-0 pe-3 small text-muted">h</span>
              </div>
              <% if @job_offer.errors[:night_end].any? %>
                <div class="text-danger small mt-1 ms-1"><%= @job_offer.errors[:night_end].first %></div>
              <% end %>
            </div>

            <%# Taux Majoration (Pourcentage) %>
            <div class="col-12">
              <%= f.label :night_rate, "MAJORATION NUIT", class: "form-label small fw-bold text-muted ls-1" %>
              <div class="input-group shadow-sm rounded-3 overflow-hidden bg-white border border-white">
                <span class="input-group-text bg-transparent border-0 ps-3 text-warning fw-bold"><i class="fa-solid fa-percent"></i></span>
                <%# On laisse l'utilisateur entrer "25" pour 25% %>
                <%= f.input_field :night_rate, class: "form-control bg-transparent border-0 fw-bold fs-5 text-end", placeholder: "Ex: 25", step: 0.1 %>
                <span class="input-group-text bg-transparent border-0 pe-4 fw-bold text-dark">%</span>
              </div>
              <% if @job_offer.errors[:night_rate].any? %>
                <div class="text-danger small mt-1 ms-1"><%= @job_offer.errors[:night_rate].first %></div>
              <% end %>
            </div>

          </div>
        </div>
      </div>

      <%# --- CONTACT --- %>
      <div class="card shadow border-0 rounded-4 mb-4">
        <div class="card-body p-4">
          <h6 class="fw-bold text-dark small mb-3"><i class="fa-solid fa-address-book me-2 text-orange"></i>Contact Candidat</h6>
          <div class="mb-2">
            <%= f.input_field :contact_email, class: "form-control bg-light border-0 shadow-sm rounded-pill py-2 px-4 text-center small", placeholder: "Email contact" %>
          </div>
          <div class="mb-2">
            <%= f.input_field :contact_phone, class: "form-control bg-light border-0 shadow-sm rounded-pill py-2 px-4 text-center small", placeholder: "Tél contact" %>
          </div>
        </div>
      </div>

      <%# --- ACTION --- %>
      <div class="mt-4">
        <%= f.button :submit, @job_offer.new_record? ? "PUBLIER" : "ENREGISTRER", class: "btn btn-orange w-100 rounded-pill fw-bold py-3 shadow-sm text-uppercase ls-1 transition-hover" %>
      </div>

    </div>

  </div>

<% end %>
