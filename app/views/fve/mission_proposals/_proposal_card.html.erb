<div class="col-md-6 col-lg-4">
  <div class="card shadow-sm rounded-4 h-100 border-0">

    <% header_class = case proposal.status
       when 'pending' then 'bg-warning-subtle text-warning-emphasis'
       when 'accepted' then 'bg-success-subtle text-success-emphasis'
       else 'bg-danger-subtle text-danger-emphasis'
       end %>

    <div class="card-header <%= header_class %> rounded-top-4 fw-bold d-flex justify-content-between align-items-center">
      <span>
        <% if proposal.pending? %>⏳ En attente
        <% elsif proposal.accepted? %>✅ Acceptée
        <% else %>❌ <%= proposal.status.humanize %>
        <% end %>
      </span>

    </div>

    <div class="card-body">
      <h5 class="card-title fw-bold mb-1">
        <i class="fa-solid fa-user-circle me-1 text-muted"></i>
        <%= proposal.merch.full_name %>
      </h5>
      <p class="text-muted small mb-3">Envoyé à <%= proposal.merch.city %></p>

      <hr class="mt-0 mb-3">

      <div class="d-flex align-items-center mb-2 small">
        <i class="fa-solid fa-calendar-day text-orange me-2" style="width:20px"></i>
        <strong><%= l proposal.date, format: :long %></strong>
        <span class="ms-auto">
          <%= proposal.start_time.strftime('%H:%M') %> - <%= proposal.end_time.strftime('%H:%M') %>
        </span>
      </div>

      <div class="d-flex align-items-center mb-2 small">
        <i class="fa-solid fa-building text-orange me-2" style="width:20px"></i>
        <span class="fw-semibold"><%= proposal.company %></span>
      </div>

      <div class="d-flex align-items-center mb-2 small">
        <i class="fa-solid fa-store text-orange me-2" style="width:20px"></i>
        <span class="text-truncate" title="<%= proposal.store_address %>">
          <%= proposal.store_name %> (<%= proposal.store_address.split(',').last.to_s.strip %>)
        </span>
      </div>

      <hr class="mt-3 mb-3">

      <div class="d-flex justify-content-between align-items-center">
        <div>
          <span class="text-muted small d-block">Taux Horaire Proposé :</span>
          <span class="fw-bold fs-5 text-orange"><%= number_to_currency(proposal.hourly_rate) %>/h</span>
        </div>
        <div class="text-end">
          <span class="text-muted small d-block">KM Estimés :</span>
          <span class="fw-bold"><%= proposal.effective_km.to_i %> km</span>
        </div>
      </div>

      <%# MESSAGE (Optionnel) %>
      <% if proposal.message.present? %>
        <div class="mt-3 p-2 bg-light rounded small fst-italic text-muted border-start border-3 border-secondary-subtle">
          "<%= truncate(proposal.message, length: 80) %>"
        </div>
      <% end %>

    </div>
  </div>
</div>
