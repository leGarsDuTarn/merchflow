<%= form_with model: work_session, local: true, html: { data: { turbo: false, controller: "break" } } do |f| %>

  <%# --- 1. CONTRAT & ENTREPRISE --- %>
  <div class="card shadow-sm border-0 rounded-4 mb-4 overflow-hidden">
    <div class="card-header bg-white border-0 pt-4 px-4 pb-4">
      <h6 class="fw-bold text-orange text-uppercase ls-1 mb-0" style="font-size: 0.80rem;">
        <i class="fa-regular fa-building me-2"></i>Client
      </h6>
    </div>
    <div class="card-body p-4">
      <% if @contract.nil? %>
        <div class="mb-3">
          <%= f.label :contract_id, "CONTRAT", class: "form-label small fw-bold text-muted" %>
          <%= f.collection_select :contract_id, current_user.contracts.order(created_at: :desc), :id, :agency_label, { prompt: "Choisir un contrat..." }, class: "form-select bg-light border-0 fw-bold" %>
          <%= inline_error_for(work_session, :contract_id) %>
        </div>
      <% else %>
        <%= f.hidden_field :contract_id, value: @contract.id %>
      <% end %>

      <div class="mb-0">
        <%= f.label :company, "ENTREPRISE", class: "form-label small fw-bold text-muted" %>
        <%= f.text_field :company, class: "form-control form-control-lg bg-light border-0 fw-bold", placeholder: "Ex: Lindt, PepsiCo..." %>
      </div>
    </div>
  </div>

  <%# --- 2. TEMPS DE TRAVAIL --- %>
  <div class="card shadow-sm border-0 rounded-4 mb-4 overflow-hidden">
    <div class="card-header bg-orange-light border-0 pt-4 px-4 pb-4">
      <h6 class="fw-bold text-dark text-uppercase ls-1 mb-0" style="font-size: 0.80rem;">
        <i class="fa-solid fa-clock me-2 text-warning"></i>Horaires & Date
      </h6>
    </div>
    <div class="card-body p-4 bg-light">
      <div class="mb-3">
        <%= f.label :date, "DATE DE LA MISSION", class: "form-label small fw-bold text-muted" %>
        <%= f.date_field :date, class: "form-control bg-white border-0 shadow-sm fw-bold" %>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-6">
          <%= f.label :start_time, "DÉBUT", class: "form-label small fw-bold text-muted" %>
          <%= f.time_field :start_time, class: "form-control bg-white border-0 shadow-sm fw-bold" %>
        </div>
        <div class="col-6">
          <%= f.label :end_time, "FIN", class: "form-label small fw-bold text-muted" %>
          <%= f.time_field :end_time, class: "form-control bg-white border-0 shadow-sm fw-bold" %>
        </div>
      </div>

      <%# SECTION COUPURE (BREAK) - Adaptée au style gris/blanc %>
      <div class="p-3 rounded-4 border bg-white shadow-sm">
        <div class="form-check form-switch">
          <input class="form-check-input custom-orange-switch" type="checkbox" id="toggleBreak" data-action="change->break#toggle" <%= 'checked' if work_session.has_break? %>>
          <label class="form-check-label fw-bold text-dark small" for="toggleBreak">
            <i class="fa-solid fa-mug-hot me-2 text-orange"></i>PAUSE
          </label>
        </div>

        <div id="break-inputs" data-break-target="fields" class="mt-3 <%= 'd-none' unless work_session.has_break? %>">
          <div class="row g-2">
            <div class="col-6">
              <%= f.time_field :break_start_time, class: "form-control form-control-sm bg-light border-0 text-center fw-bold" %>
            </div>
            <div class="col-6">
              <%= f.time_field :break_end_time, class: "form-control form-control-sm bg-light border-0 text-center fw-bold" %>
            </div>
          </div>
          <div class="mt-2 text-muted" style="font-size: 0.75rem;">
            <i class="fa-solid fa-info-circle"></i> Cette période sera déduite du temps payé.
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# --- 3. LIEU & DÉPLACEMENT --- %>
  <div class="card shadow-sm border-0 rounded-4 mb-4 overflow-hidden">
    <div class="card-header bg-white border-0 pt-4 px-4 pb-4">
      <h6 class="fw-bold text-orange text-uppercase ls-1 mb-0" style="font-size: 0.80rem;">
        <i class="fa-solid fa-map-location-dot me-2"></i>Lieu de mission
      </h6>
    </div>
    <div class="card-body p-4">
      <div class="mb-3">
        <%= f.label :store, "MAGASIN", class: "form-label small fw-bold text-muted" %>
        <%= f.text_field :store, class: "form-control bg-light border-0 fw-bold", placeholder: "Ex: Intermarché Carmaux" %>
      </div>
      <div class="mb-3">
        <%= f.label :store_full_address, "ADRESSE", class: "form-label small fw-bold text-muted" %>
        <%= f.text_field :store_full_address, class: "form-control bg-light border-0 fw-bold", placeholder: "Adresse complète..." %>
      </div>
      <div class="row g-3">
        <div class="col-6">
          <%= f.label :km_custom, "KM RÉELS", class: "form-label small fw-bold text-muted" %>
          <div class="input-group">
            <%= f.number_field :km_custom, step: 0.1, class: "form-control bg-light border-0 fw-bold" %>
            <span class="input-group-text bg-light border-0 fw-bold text-muted">km</span>
          </div>
        </div>
        <div class="col-6 d-flex align-items-end">
          <div class="form-check mb-2">
            <%= f.check_box :recommended, class: "form-check-input custom-orange-check" %>
            <%= f.label :recommended, "KM non plafonné ?", class: "form-check-label small fw-bold" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# --- 4. FINANCES ANNEXES --- %>
  <div class="card shadow-sm border-0 rounded-4 mb-4 overflow-hidden">
    <div class="card-header bg-white border-0 pt-4 px-4 pb-4">
      <h6 class="fw-bold text-orange text-uppercase ls-1 mb-0" style="font-size: 0.80rem;">
        <i class="fa-solid fa-receipt me-2"></i>Frais & Salaire
      </h6>
    </div>
    <div class="card-body p-4">
      <div class="mb-4">
        <%= f.label :hourly_rate, "TAUX HORAIRE (€)", class: "form-label small fw-bold text-muted" %>
        <%= f.number_field :hourly_rate, step: 0.01, class: "form-control bg-light border-0 fw-bold" %>
      </div>

      <div class="row g-2">
        <div class="col-4">
          <%= f.label :fee_meal, "REPAS", class: "form-label small fw-bold text-muted text-center d-block" %>
          <%= f.number_field :fee_meal, step: 0.01, class: "form-control bg-light border-0 fw-bold text-center", placeholder: "0.00" %>
        </div>
        <div class="col-4">
          <%= f.label :fee_parking, "PARKING", class: "form-label small fw-bold text-muted text-center d-block" %>
          <%= f.number_field :fee_parking, step: 0.01, class: "form-control bg-light border-0 fw-bold text-center", placeholder: "0.00" %>
        </div>
        <div class="col-4">
          <%= f.label :fee_toll, "PÉAGE", class: "form-label small fw-bold text-muted text-center d-block" %>
          <%= f.number_field :fee_toll, step: 0.01, class: "form-control bg-light border-0 fw-bold text-center", placeholder: "0.00" %>
        </div>
      </div>
      <div class="mt-3 text-muted fst-italic" style="font-size: 0.75rem;">
        <i class="fa-solid fa-circle-info me-1"></i> Ces frais seront ajoutés au total net estimé.
      </div>
    </div>
  </div>

  <%# --- 5. NOTES & SUBMIT --- %>
  <div class="mb-4">
    <%= f.label :notes, "NOTES (OPTIONNEL)", class: "form-label small fw-bold text-muted" %>
    <%= f.text_area :notes, rows: 2, class: "form-control bg-white border-0 shadow-sm rounded-3", placeholder: "Détails..." %>
  </div>

  <div class="d-grid pb-5">
    <%= f.submit "Enregistrer la mission", class: "btn btn-orange fw-bold rounded-pill shadow-sm btn-lg" %>
  </div>

<% end %>
