<div class="container mt-5">
  <div class="row">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <span class="badge bg-primary mb-2"><%= @job_offer.mission_type.capitalize %></span>
              <h1 class="h2"><%= @job_offer.title %></h1>
              <p class="text-muted">
                <i class="fas fa-map-marker-alt me-2"></i><%= @job_offer.city %> (<%= @job_offer.zipcode %>) — <%= @job_offer.store_name %>
              </p>
            </div>
            <div class="text-end">
              <span class="h3 text-success d-block mb-0"><%= @job_offer.hourly_rate %> €</span>
              <small class="text-muted">Brut / heure</small>
            </div>
          </div>

          <hr>

          <div class="mission-description my-4">
            <h4 class="mb-3">Description de la mission</h4>
            <div class="text-secondary" style="white-space: pre-wrap;">
              <%= @job_offer.description %>
            </div>
          </div>

          <div class="row g-3">
            <div class="col-sm-6">
              <div class="p-3 border rounded bg-light">
                <i class="fas fa-calendar-alt text-primary me-2"></i>
                <strong>Date :</strong> <%= l(@job_offer.start_date.to_date, format: :long) %>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="p-3 border rounded bg-light">
                <i class="fas fa-clock text-primary me-2"></i>
                <strong>Horaires :</strong> <%= @job_offer.start_date.strftime("%H:%M") %> - <%= @job_offer.end_date.strftime("%H:%M") %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card border-0 shadow-sm sticky-top" style="top: 2rem;">
        <div class="card-body p-4">
          <h4 class="mb-3">Postuler</h4>

          <% if user_signed_in? %>
            <% if @already_applied %>
              <div class="alert alert-info border-0 mb-0 text-center">
                <i class="fas fa-check-circle me-2"></i> Vous avez déjà postulé.
              </div>
            <% else %>
              <%# Simple Form pour le message de candidature %>
              <%= simple_form_for([@job_offer, @job_application]) do |f| %>
                <%= f.input :message,
                            label: "Votre message (optionnel)",
                            placeholder: "Disponibilités, expérience...",
                            input_html: { rows: 4 } %>

                <%= f.button :submit, "Envoyer ma candidature", class: "btn btn-primary btn-lg w-100 mt-3" %>
              <% end %>
            <% end %>
          <% else %>
            <div class="text-center py-3">
              <p class="text-muted">Connectez-vous pour postuler à cette offre.</p>
              <%= link_to "Se connecter / S'inscrire", new_user_session_path, class: "btn btn-outline-primary w-100" %>
            </div>
          <% end %>

          <div class="mt-4 pt-4 border-top">
            <p class="small text-muted mb-1">Employeur : <strong><%= @job_offer.company_name %></strong></p>
            <p class="small text-muted">Contrat : <strong><%= @job_offer.contract_type.upcase %></strong></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
