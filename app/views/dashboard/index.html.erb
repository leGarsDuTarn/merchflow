<div class="container mt-4 mb-5">

  <!-- TITRE -->
  <h1 class="fw-bold text-orange text-center mb-4">
    Tableau de bord
  </h1>

  <p class="text-center text-muted mb-5">
    Votre activité merch, résumée en un coup d'œil.
  </p>

  <!-- LIGNES DE STATS -->
  <div class="row g-4">

    <!-- Heures totales -->
    <div class="col-md-6 col-lg-3">
      <div class="card shadow-sm p-4 rounded-4 text-center h-100">
        <h5 class="text-muted mb-0">Heures travaillées</h5>
        <p class="display-6 fw-bold mt-2">
          <%= current_user.total_hours_worked %> h
        </p>
      </div>
    </div>

    <!-- Brut total -->
    <div class="col-md-6 col-lg-3">
      <div class="card shadow-sm p-4 rounded-4 text-center h-100">
        <h5 class="text-muted mb-0">Total Brut</h5>
        <p class="display-6 fw-bold mt-2">
          <%= number_to_currency(current_user.total_brut, unit: "€", format: "%n %u") %>
        </p>
      </div>
    </div>

    <!-- IFM + CP -->
    <div class="col-md-6 col-lg-3">
      <div class="card shadow-sm p-4 rounded-4 text-center h-100">
        <h5 class="text-muted mb-0">IFM + CP</h5>
        <p class="display-6 fw-bold mt-2">
          <%= number_to_currency(current_user.total_ifm_cp, unit: "€", format: "%n %u") %>
        </p>
      </div>
    </div>

    <!-- Kilomètres -->
    <div class="col-md-6 col-lg-3">
      <div class="card shadow-sm p-4 rounded-4 text-center h-100">
        <h5 class="text-muted mb-0">Kilomètres</h5>
        <p class="display-6 fw-bold mt-2">
          <%= current_user.total_km.to_i %> km
        </p>
      </div>
    </div>

  </div>

  <!-- DEUXIÈME LIGNE -->
  <div class="row g-4 mt-4">

    <!-- Paiement KM -->
    <div class="col-md-6 col-lg-4">
      <div class="card shadow-sm p-4 rounded-4 text-center h-100">
        <h5 class="text-muted mb-0">Frais kilomètres remboursés</h5>
        <p class="display-6 fw-bold mt-2">
          <%= number_to_currency(current_user.total_km_payment, unit: "€", format: "%n %u") %>
        </p>
      </div>
    </div>

    <!-- Répartition par agence -->
    <div class="col-md-12 col-lg-8">
      <div class="card shadow-sm p-4 rounded-4 h-100">
        <h5 class="fw-bold text-orange mb-3 text-center">
          Répartition par agence
        </h5>

        <% if current_user.total_by_agency.any? %>
          <table class="table table-borderless align-middle mb-0">
            <thead>
              <tr class="text-muted">
                <th>Agence</th>
                <th>Heures</th>
                <th>Brut</th>
                <th>Km</th>
              </tr>
            </thead>
            <tbody>
              <% current_user.total_by_agency.each do |stats| %>
                <tr>
                  <td><strong><%= stats[:agency] %></strong></td>
                  <td><%= stats[:hours] %> h</td>
                  <td><%= number_to_currency(stats[:brut], unit: "€", format: "%n %u") %></td>
                  <td><%= stats[:km].to_i %> km</td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <p class="text-center text-muted m-0">
            Aucune donnée disponible pour l’instant.
          </p>
        <% end %>
      </div>
    </div>

  </div>

  <!-- BOUTONS ACTION -->
  <div class="text-center mt-5">

    <!-- Créer un contrat -->
    <%= link_to "Créer un contrat",
                new_contract_path,
                class: "btn btn-orange btn-lg fw-bold px-4 me-3" %>

    <!-- Créer une mission (si au moins 1 contrat) -->
    <% if current_user.contracts.exists? %>
      <%= link_to "Créer une mission",
                  new_contract_work_session_path(current_user.contracts.first),
                  class: "btn btn-orange-outline btn-lg fw-bold px-4" %>
    <% else %>
      <button class="btn btn-orange-outline btn-lg fw-bold px-4" disabled>
        Créer une mission
      </button>
      <p class="text-muted mt-2 small">
        Vous devez d’abord créer un contrat.
      </p>
    <% end %>

  </div>

</div>

<footer class="text-center text-muted mt-4">
  <small>© <%= Time.current.year %> MerchFlow — Votre assistant administratif merch.</small>
</footer>

