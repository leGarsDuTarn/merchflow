<div class="container mt-4">

  <h1 class="fw-bold text-orange mb-4 text-center">Invitations FVE</h1>

  <div class="text-center mb-3">
    <%= link_to "Nouvelle invitation",
                new_admin_fve_invitation_path,
                class: "btn btn-orange fw-semibold" %>
  </div>

  <div class="row g-4">
    <% @invitations.each do |inv| %>
      <div class="col-md-6 col-lg-4">
        <div class="card shadow-sm rounded-4 p-3 h-100">

          <h5 class="fw-bold text-orange mb-1"><%= inv.email %></h5>

          <p class="text-muted mb-2">
            <strong>Agence :</strong>
            <%# CORRECTION ICI : On cherche le label dans la DB, sinon on affiche le code %>
            <%= Agency.find_by(code: inv.agency)&.label || inv.agency.presence || "—" %>
            <br>

            <strong>Premium :</strong>
            <% if inv.premium? %>
              <span class="text-success"><i class="bi bi-check-circle-fill"></i> Oui</span>
            <% else %>
              <span class="text-muted">Non</span>
            <% end %>
            <br>

            <strong>Expire :</strong>
            <%# Petit ajustement pour gérer les dates vides au cas où %>
           <%= inv.expires_at ? inv.expires_at.strftime("%d/%m à %H:%M") : "—" %>
          </p>

          <div class="d-flex justify-content-between align-items-center mt-3">
            <div>
              <% if inv.used? %>
                <span class="badge p-2 bg-success rounded-pill">Utilisée</span>
              <% elsif inv.expired? %>
                <span class="badge bg-danger rounded-pill">Expirée</span>
              <% else %>
                <span class="badge bg-warning text-dark rounded-pill">Active</span>
              <% end %>
            </div>

            <%= link_to "Supprimer",
                        admin_fve_invitation_path(inv),
                        data: {
                          turbo_method: :delete,
                          turbo_confirm: "Êtes-vous sûr de vouloir supprimer cette invitation ?"
                        },
                        class: "btn btn-sm btn-red" %>
          </div>

        </div>
      </div>
    <% end %>
  </div>

  <% if @invitations.empty? %>
    <div class="text-center text-muted mt-5">
      <p>Aucune invitation trouvée.</p>
    </div>
  <% end %>

</div>
