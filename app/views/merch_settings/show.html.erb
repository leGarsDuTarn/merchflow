<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-7 col-xl-6">

      <%# --- HEADER --- %>
      <div class="text-center mb-5">
        <h1 class="fw-bold text-orange mb-2">Confidentialité & Missions</h1>
        <p class="text-muted">
          Gérez votre visibilité et vos préférences en temps réel.
        </p>
      </div>

      <%# --- CARTE PRINCIPALE --- %>
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden mb-5">

        <%# Ligne décorative orange %>
        <div class="bg-orange" style="height: 6px; width: 100%;"></div>

        <div class="p-4 p-md-5">

          <%# --- SECTION 1 : PRÉFÉRENCES DE CONTACT (Formulaire classique) --- %>
          <div class="d-flex align-items-center mb-4">
            <div class="bg-light text-orange rounded-circle p-2 me-3 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
              <i class="fa-solid fa-sliders fs-5"></i>
            </div>
            <h5 class="fw-bold m-0 text-dark">Préférences Générales</h5>
          </div>

          <%= form_with model: @merch_setting, url: merch_settings_path, method: :patch, class: "mb-4" do |f| %>

            <div class="mb-4">
              <label class="form-label fw-semibold text-muted small text-uppercase">Canal favori de communication</label>
              <%= f.select :preferred_contact_channel,
                  options_for_select([['Téléphone', 'phone'], ['Email', 'email'], ['Application', 'message'], ['Ne pas déranger', 'none']], @merch_setting.preferred_contact_channel),
                  {},
                  class: "form-select bg-light border-0 py-3 rounded-3 shadow-none fw-semibold" %>
            </div>

            <div class="d-grid">
              <%= f.submit 'Enregistrer les préférences', class: "btn btn-orange rounded-pill fw-bold py-2 shadow-sm" %>
            </div>
          <% end %>

          <hr class="border-secondary border-opacity-10 my-2">

          <%# --- SECTION 2 : VISIBILITÉ (AJAX) --- %>
          <div class="d-flex align-items-center mb-4">
             <div class="bg-light text-orange rounded-circle p-2 me-3 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
              <i class="fa-solid fa-shield-halved fs-5"></i>
            </div>
            <div>
              <h5 class="fw-bold m-0 text-dark">Contrôle Rapide</h5>
              <small class="text-muted">Cliquez pour activer/désactiver instantanément</small>
            </div>
          </div>

          <div class="d-flex flex-column gap-3">

            <%# Groupe : Données Personnelles %>
            <p class="text-orange fw-bold small text-uppercase mb-1 mt-2">Mes données</p>

            <%= render 'merch_settings/toggle_item', label: 'Afficher mon identité', icon: 'fa-id-card', status: @merch_setting.allow_identity?, path: toggle_identity_merch_settings_path %>
            <%= render 'merch_settings/toggle_item', label: 'Partager mon adresse', icon: 'fa-map-location-dot', status: @merch_setting.share_address?, path: toggle_share_address_merch_settings_path %>
            <%= render 'merch_settings/toggle_item', label: 'Partager mon planning', icon: 'fa-calendar-days', status: @merch_setting.share_planning?, path: toggle_share_planning_merch_settings_path %>

            <%# Groupe : Canaux Autorisés %>
            <p class="text-orange fw-bold small text-uppercase mb-1 mt-4">Canaux autorisés</p>

            <%= render 'merch_settings/toggle_item', label: 'Contact par Email', icon: 'fa-envelope', status: @merch_setting.allow_contact_email?, path: toggle_allow_email_merch_settings_path %>
            <%= render 'merch_settings/toggle_item', label: 'Contact par Téléphone', icon: 'fa-phone', status: @merch_setting.allow_contact_phone?, path: toggle_allow_phone_merch_settings_path %>
            <%= render 'merch_settings/toggle_item', label: 'Contact par Message', icon: 'fa-comment-dots', status: @merch_setting.allow_contact_message?, path: toggle_allow_message_merch_settings_path %>

            <%# Groupe : Missions %>
            <p class="text-orange fw-bold small text-uppercase mb-1 mt-4">Missions</p>

            <%= render 'merch_settings/toggle_item', label: 'Accepter des propositions', icon: 'fa-handshake', status: @merch_setting.accept_mission_proposals?, path: toggle_accept_mission_proposals_merch_settings_path %>

            <div class="ps-3 border-start border-2 border-light mt-2">
              <%= render 'merch_settings/toggle_item', label: 'Rôle : Merchandising', icon: 'fa-box-open', status: @merch_setting.role_merch?, path: toggle_role_merch_merch_settings_path %>
              <div class="mt-2"></div>
              <%= render 'merch_settings/toggle_item', label: 'Rôle : Animation', icon: 'fa-bullhorn', status: @merch_setting.role_anim?, path: toggle_role_anim_merch_settings_path %>
            </div>

          </div>

        </div>
      </div>

      <div class="text-center">
        <%= link_to "Retour au tableau de bord", root_path, class: "text-muted text-decoration-none small hover-orange" %>
      </div>

    </div>
  </div>
</div>
