<div class="container my-5">

  <%# --- HEADER --- %>
  <div class="d-flex justify-content-between align-items-end mb-5">
    <div>
      <h2 class="fw-bold text-dark m-0">Mes Contrats</h2>
      <p class="text-muted small m-0">Gérez vos contrats et missions</p>
    </div>
  </div>

  <% if @contracts.empty? %>

    <%# --- EMPTY STATE (Cas vide) --- %>
    <div class="card border-dashed border-2 bg-light rounded-4 p-5 text-center mt-5">
      <div class="mb-4 text-muted opacity-50">
        <i class="fa-solid fa-file-signature fa-4x"></i>
      </div>
      <h4 class="fw-bold text-dark">Aucun contrat actif</h4>
      <p class="text-muted mb-4">Créez votre premier contrat pour commencer à saisir vos heures et suivre vos gains.</p>

      <%# Container pour limiter la largeur du bouton et le centrer %>
      <div class="d-flex justify-content-center">
        <div style="max-width: 300px; width: 100%;">
          <%= link_to new_contract_path, class: "btn btn-orange rounded-pill px-5 fw-bold shadow-sm w-100" do %>
            Créer un contrat
          <% end %>
        </div>
      </div>
    </div>

  <% else %>

    <%# --- LISTE DES CONTRATS (Cas rempli) --- %>
    <div class="row g-4">
      <% @contracts.each do |contract| %>
        <div class="col-12 col-md-6 col-lg-4">

          <div class="card border-0 shadow-sm rounded-4 h-100 bg-white p-4 position-relative overflow-hidden card-hover-effect">

            <%# Petite barre latérale couleur %>
            <div class="position-absolute start-0 top-0 bottom-0 bg-orange" style="width: 4px;"></div>

            <div class="d-flex justify-content-between align-items-start mb-3">
              <%# Logo/Icône Agence %>
              <div class="d-flex align-items-center">
                <div class="rounded-3 bg-light text-orange d-flex align-items-center justify-content-center me-3" style="width: 45px; height: 45px;">
                  <i class="fa-solid fa-building fs-5"></i>
                </div>
                <div>
                  <span class="d-block text-muted small text-uppercase fw-bold" style="font-size: 0.7rem; letter-spacing: 0.5px;">Agence</span>
                  <span class="fw-bold text-dark"><%= contract.agency_label %></span>
                </div>
              </div>

              <%# Badge Type %>
              <span class="badge bg-orange-subtle text-orange border border-orange-subtle rounded-pill px-3 py-2">
                <%= contract.contract_type_label %>
              </span>
            </div>

            <div class="mb-1 ps-2">
              <% count = contract.work_sessions.count %>

                <% if count > 0 %>
                  <span class="badge bg-orange-subtle text-orange border border-orange-subtle rounded-pill px-3 py-1 fw-bold">
                    <%= pluralize(count, 'mission') %>
                  </span>
                <% else %>
                  <span class="text-muted small">Aucune mission enregistrée</span>
                <% end %>
            </div>

            <p class="text-muted small ps-2 mb-4">
              Contrat créé le <%= l contract.created_at.to_date, format: :long %>
            </p>

            <%# Footer de la carte : Actions %>
            <div class="mt-auto d-flex justify-content-between align-items-center border-top pt-3 ps-2">

              <%# 1. Le lien principal (VOIR) %>
              <%= link_to contract_path(contract), class: "text-decoration-none btn-orange rounded-pill fw-bold small stretched-link" do %>
                Voir les missions
              <% end %>

              <%# 2. Les boutons d'action %>
              <div class="d-flex gap-2 position-relative" style="z-index: 2;">
                <%= link_to edit_contract_path(contract),
                  class: "btn btn-white border shadow-sm rounded-circle d-flex align-items-center justify-content-center",
                  style: "width: 32px; height: 32px; padding: 0;",
                  title: "Modifier" do %>
                    <i class="fa-solid fa-pen text-muted" style="font-size: 0.8rem;"></i>
                  <% end %>

                <%= link_to contract_path(contract),
                  data: {
                    turbo_method: :delete,
                    turbo_confirm: "Êtes-vous sûr de vouloir supprimer ce contrat ? Toutes les missions associées seront perdues."
                  },
                  class: "btn btn-white border shadow-sm rounded-circle d-flex align-items-center justify-content-center",
                  style: "width: 32px; height: 32px; padding: 0;",
                  title: "Supprimer" do %>
                    <i class="fa-solid fa-trash-can text-danger" style="font-size: 0.8rem;"></i>
                  <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <%# --- BOUTON AJOUTER SECONDAIRE --- %>
    <%# Il est maintenant DANS le bloc ELSE, donc invisible si liste vide %>
    <div class="container d-flex align-items-center justify-content-center mt-5">
      <%= link_to new_contract_path,
                    class: "btn btn-orange rounded-pill px-4 fw-bold shadow-sm",
                    title: "Nouveau contrat" do %>
          <i class="fa-solid fa-plus me-2"></i> Ajouter un contrat
        <% end %>
    </div>

  <% end %> <%# Fin du if/else %>

</div>
